{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login - PostgreSQL Viewer</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#181920;
            --panel:#24262e;
            --card:#2a2c35;
            --muted:#9aa0b2;
            --text:#e6e9ef;
            --accent1:#4f78ff;
            --accent2:#6c4dff;
            --success:#10b981;
            --danger:#ef4444;
            --glass: rgba(255,255,255,0.02);
            --radius:12px;
        }

        *{box-sizing:border-box;margin:0;padding:0}
        html,body{height:100%}
        body{
            font-family:'Poppins',sans-serif;
            background: linear-gradient(180deg,#15161a 0%, #1a1c22 100%);
            color:var(--text);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:28px;
        }

        /* centered card similar to edit_module dark UI */
        .wrap {
            width: 480px;
            max-width:96%;
        }

        .card {
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
            border: 1px solid rgba(255,255,255,0.03);
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            border-radius: 16px;
            padding: 28px;
            overflow: hidden;
        }

        .brand {
            display:flex;
            gap:14px;
            align-items:center;
            margin-bottom:18px;
        }

        .logo {
            width:56px;height:56px;border-radius:12px;
            background:linear-gradient(135deg,var(--accent1),var(--accent2));
            display:flex;align-items:center;justify-content:center;
            font-size:22px;
            box-shadow: 0 6px 20px rgba(79,120,255,0.12);
        }

        .brand h1{
            font-size:20px;
            color:var(--text);
            margin:0;
            font-weight:700;
        }

        .brand p{
            margin:0;
            color:var(--muted);
            font-size:0.92rem;
            margin-top:3px;
        }

        .card-body { margin-top: 10px; }

        label.section-title {
            display:block;
            font-size:0.95rem;
            color:var(--muted);
            margin-bottom:10px;
            font-weight:600;
        }

        .form-row {
            display:flex;
            flex-direction:column;
            gap:12px;
            margin-bottom:14px;
        }

        input[type="text"], input[type="password"] {
            width:100%;
            padding:12px 14px;
            border-radius:10px;
            background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
            color:var(--text);
            border:1px solid rgba(255,255,255,0.03);
            font-size:0.98rem;
            transition: box-shadow 0.18s ease, border-color 0.18s ease;
            outline:none;
            -webkit-appearance:none;
        }

        input::placeholder { color: rgba(230,233,239,0.35); }

        input:focus {
            box-shadow: 0 6px 18px rgba(79,120,255,0.06);
            border-color: rgba(79,120,255,0.28);
        }

        .submit-row {
            display:flex;
            gap:12px;
            align-items:center;
            margin-top:8px;
        }

        button.primary {
            background: linear-gradient(135deg,var(--accent1),var(--accent2));
            color:white;
            padding:11px 18px;
            border-radius:10px;
            border:none;
            font-weight:600;
            cursor:pointer;
            min-width:120px;
            box-shadow: 0 8px 30px rgba(79,120,255,0.12);
            transition: transform .12s ease, opacity .12s ease;
        }

        button.primary:active{ transform: translateY(1px) }
        button.ghost {
            background: transparent;
            color: var(--muted);
            border: 1px solid rgba(255,255,255,0.03);
            padding:11px 16px;
            border-radius:10px;
            cursor:pointer;
            font-weight:600;
        }

        .helper {
            color:var(--muted);
            font-size:0.9rem;
            margin-top:12px;
        }

        .alert {
            margin-top:14px;
            padding:10px 12px;
            border-radius:10px;
            font-size:0.95rem;
        }

        .alert.error {
            background: rgba(239,68,68,0.06);
            color: #ffb4b4;
            border:1px solid rgba(239,68,68,0.08);
        }

        .table-select {
            margin-top:18px;
            background:var(--glass);
            border-radius:12px;
            padding:12px;
            border:1px solid rgba(255,255,255,0.02);
            max-height:220px;
            overflow:auto;
        }

        .table-item {
            display:flex;
            align-items:center;
            gap:10px;
            padding:8px;
            border-radius:8px;
            transition: background .12s ease, transform .12s ease;
        }

        .table-item:hover {
            background: rgba(255,255,255,0.01);
            transform: translateX(4px);
        }

        .table-item input[type="checkbox"]{
            width:18px;height:18px;
            accent-color: var(--accent1);
        }

        .muted-small { color: var(--muted); font-size:0.9rem; }

        @media (max-width:520px){
            .wrap{ width: 94% }
            .brand h1{ font-size:18px }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="card">
            {% if user_name %}
                <!-- Logged-in quick-create UI (keeps original logic) -->
                <div class="brand">
                    <div class="logo">üìä</div>
                    <div>
                        <h1>Welcome back, {{ user_name|title }}</h1>
                        <p class="muted-small">Create a new module quickly ‚Äî select tables and save</p>
                    </div>
                </div>

                <div class="card-body">
                    <form method="POST" action="{% url 'create_module' %}">
                        {% csrf_token %}
                        <label class="section-title">Select Tables</label>

                        {% if tables %}
                            <div class="table-select">
                                {% for table in tables %}
                                    <div class="table-item">
                                        <input type="checkbox" name="selected_tables" value="{{ table }}" id="tbl_{{ forloop.counter }}">
                                        <label for="tbl_{{ forloop.counter }}" class="muted-small">{{ table }}</label>
                                    </div>
                                {% endfor %}
                            </div>

                            <label class="section-title" style="margin-top:14px">Module name</label>
                            <input type="text" name="module_name" class="module-name-input" placeholder="eg. sales_analysis" required>

                            <div class="submit-row">
                                <button type="submit" class="primary">üöÄ Create Module</button>
                                <button type="button" class="ghost" onclick="location.href='{% url 'dashboard' %}'">‚Üê Back to Dashboard</button>
                            </div>
                        {% else %}
                            <p class="helper">No user tables found in database.</p>
                        {% endif %}
                    </form>
                </div>

            {% else %}
                <!-- Login form (same logic as original) -->
                <div class="brand">
                    <div class="logo">üîê</div>
                    <div>
                        <h1>Sign in</h1>
                        <p class="muted-small">Login to manage your PostgreSQL modules</p>
                    </div>
                </div>

                <div class="card-body">
                    <form method="POST" action="">
                        {% csrf_token %}
                        <label class="section-title">Username</label>
                        <input type="text" name="username" placeholder="Username" required>

                        <label class="section-title">Password</label>
                        <input type="password" name="password" placeholder="Password" required>

                        <div class="submit-row">
                            <button type="submit" class="primary">Login</button>
                            <button type="button" class="ghost" onclick="location.href='/'">Cancel</button>
                        </div>

                        {% if error_message %}
                            <div class="alert error">{{ error_message }}</div>
                        {% endif %}
                    </form>
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html>
